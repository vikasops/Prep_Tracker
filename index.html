<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps Preparation Tracker - Debug Version</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
:root {
  --color-primary: #2563eb;
  --color-primary-light: #3b82f6;
  --color-primary-dark: #1d4ed8;
  --color-secondary: #64748b;
  --color-success: #10b981;
  --color-warning: #f59e0b;
  --color-danger: #ef4444;
  --color-background: #f8fafc;
  --color-surface: #ffffff;
  --color-border: #e2e8f0;
  --color-text: #1e293b;
  --color-text-muted: #64748b;
  --border-radius: 8px;
  --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
  --transition: all 0.2s ease-in-out;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  line-height: 1.6;
  color: var(--color-text);
  background-color: var(--color-background);
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
}

/* Debug Panel */
.debug-panel {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-lg);
  width: 350px;
  max-height: 400px;
  z-index: 1000;
  overflow: hidden;
}

.debug-header {
  background: var(--color-primary);
  color: white;
  padding: 0.75rem 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
}

.debug-toggle {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 3px;
}

.debug-toggle:hover {
  background: rgba(255, 255, 255, 0.2);
}

.debug-content {
  padding: 1rem;
  max-height: 300px;
  overflow-y: auto;
  font-size: 0.875rem;
}

.debug-content.collapsed {
  display: none;
}

.debug-item {
  margin-bottom: 0.75rem;
  padding: 0.5rem;
  border-radius: var(--border-radius);
  border: 1px solid var(--color-border);
}

.debug-item.success {
  background: rgba(16, 185, 129, 0.1);
  border-color: var(--color-success);
}

.debug-item.warning {
  background: rgba(245, 158, 11, 0.1);
  border-color: var(--color-warning);
}

.debug-item.error {
  background: rgba(239, 68, 68, 0.1);
  border-color: var(--color-danger);
}

.debug-label {
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.debug-value {
  font-family: monospace;
  font-size: 0.8rem;
  word-break: break-all;
}

.debug-test-btn {
  background: var(--color-primary);
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-size: 0.875rem;
  margin-right: 0.5rem;
  margin-bottom: 0.5rem;
}

.debug-test-btn:hover {
  background: var(--color-primary-dark);
}

.debug-test-btn:disabled {
  background: var(--color-secondary);
  cursor: not-allowed;
}

/* Header */
.header {
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: 1rem 0;
  position: sticky;
  top: 0;
  z-index: 100;
}

.header .container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.header__title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-primary);
  text-decoration: none;
}

.header__nav {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.header__controls {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  flex-wrap: wrap;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: var(--border-radius);
  font-size: 0.875rem;
  font-weight: 500;
  text-decoration: none;
  cursor: pointer;
  transition: var(--transition);
  white-space: nowrap;
  text-align: center;
  justify-content: center;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.btn--sm {
  padding: 0.375rem 0.75rem;
  font-size: 0.8rem;
}

.btn--primary {
  background: var(--color-primary);
  color: white;
}

.btn--primary:hover:not(:disabled) {
  background: var(--color-primary-dark);
}

.btn--outline {
  background: transparent;
  color: var(--color-primary);
  border: 1px solid var(--color-primary);
}

.btn--outline:hover:not(:disabled) {
  background: var(--color-primary);
  color: white;
}

/* Setup Guide */
.setup-guide {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius);
  margin: 2rem 0;
  overflow: hidden;
}

.setup-guide h3 {
  background: var(--color-primary);
  color: white;
  padding: 1rem 1.5rem;
  margin: 0;
  font-size: 1.125rem;
}

.setup-guide-content {
  padding: 1.5rem;
}

.setup-step {
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid var(--color-border);
}

.setup-step:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.step-number {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  background: var(--color-primary);
  color: white;
  border-radius: 50%;
  font-weight: 600;
  margin-right: 1rem;
  flex-shrink: 0;
}

.step-header {
  display: flex;
  align-items: center;
  margin-bottom: 1rem;
}

.step-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--color-text);
}

.code-block {
  background: #1e293b;
  color: #e2e8f0;
  padding: 1rem;
  border-radius: var(--border-radius);
  font-family: 'Courier New', monospace;
  font-size: 0.875rem;
  overflow-x: auto;
  margin: 1rem 0;
}

.code-inline {
  background: #f1f5f9;
  color: #1e293b;
  padding: 0.125rem 0.25rem;
  border-radius: 3px;
  font-family: monospace;
  font-size: 0.9em;
}

.alert {
  padding: 1rem;
  border-radius: var(--border-radius);
  margin: 1rem 0;
  border-left: 4px solid;
}

.alert.warning {
  background: rgba(245, 158, 11, 0.1);
  border-color: var(--color-warning);
  color: #92400e;
}

.alert.error {
  background: rgba(239, 68, 68, 0.1);
  border-color: var(--color-danger);
  color: #dc2626;
}

.alert.info {
  background: rgba(37, 99, 235, 0.1);
  border-color: var(--color-primary);
  color: var(--color-primary-dark);
}

/* Auth Modal */
.auth-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(4px);
}

.auth-modal.hidden {
  display: none;
}

.auth-form {
  background: white;
  padding: 2rem;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-lg);
  width: 100%;
  max-width: 400px;
  margin: 1rem;
  position: relative;
}

.form-group {
  margin-bottom: 1rem;
}

.form-control {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius);
  font-size: 1rem;
  transition: var(--transition);
}

.form-control:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.error {
  color: var(--color-danger);
  font-size: 0.875rem;
  margin-top: 0.5rem;
  padding: 0.75rem;
  background: rgba(239, 68, 68, 0.1);
  border-radius: var(--border-radius);
  border: 1px solid rgba(239, 68, 68, 0.2);
}

.success {
  color: var(--color-success);
  font-size: 0.875rem;
  margin-top: 0.5rem;
  padding: 0.75rem;
  background: rgba(16, 185, 129, 0.1);
  border-radius: var(--border-radius);
  border: 1px solid rgba(16, 185, 129, 0.2);
}

.hidden {
  display: none !important;
}
    </style>
</head>
<body>
    <!-- Debug Panel -->
    <div class="debug-panel">
        <div class="debug-header" id="debugHeader">
            <h4>ðŸ”§ Debug Console</h4>
            <button class="debug-toggle" id="debugToggle">âˆ’</button>
        </div>
        <div class="debug-content" id="debugContent">
            <div id="debugInfo">
                <div class="debug-item" id="configStatus">
                    <div class="debug-label">Configuration Status</div>
                    <div class="debug-value" id="configValue">Checking...</div>
                </div>
                <div class="debug-item" id="supabaseStatus">
                    <div class="debug-label">Supabase Connection</div>
                    <div class="debug-value" id="supabaseValue">Testing...</div>
                </div>
                <div class="debug-item" id="authStatus">
                    <div class="debug-label">Authentication Status</div>
                    <div class="debug-value" id="authValue">Not authenticated</div>
                </div>
                <div class="debug-item" id="databaseStatus">
                    <div class="debug-label">Database Status</div>
                    <div class="debug-value" id="databaseValue">Not tested</div>
                </div>
            </div>
            <div style="margin-top: 1rem;">
                <button class="debug-test-btn" id="testConnectionBtn">Test Connection</button>
                <button class="debug-test-btn" id="testTableBtn">Test Table</button>
                <button class="debug-test-btn" id="clearLogsBtn">Clear Logs</button>
            </div>
            <div id="debugLogs" style="margin-top: 1rem; font-size: 0.75rem; max-height: 150px; overflow-y: auto; background: #1a202c; color: #e2e8f0; padding: 0.5rem; border-radius: 4px;"></div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal hidden" id="authModal">
        <div class="auth-form">
            <h2 id="authTitle">Sign In</h2>
            <form id="authForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" class="form-control" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" required placeholder="Enter your password">
                </div>
                <div class="form-group hidden" id="nameGroup">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" class="form-control" placeholder="Enter your full name">
                </div>
                <div id="authError" class="error hidden"></div>
                <div id="authSuccess" class="success hidden"></div>
                <div class="form-group">
                    <button type="submit" class="btn btn--primary" style="width: 100%;" id="authSubmit">
                        Sign In
                    </button>
                </div>
                <div style="text-align: center; margin-top: 1rem; font-size: 0.875rem;">
                    <span id="authSwitchText">Don't have an account?</span>
                    <button type="button" id="authSwitchBtn" style="background: none; border: none; color: var(--color-primary); cursor: pointer; text-decoration: underline;">Sign Up</button>
                </div>
            </form>
            <button onclick="document.getElementById('authModal').classList.add('hidden')" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>
    </div>

    <header class="header">
        <div class="container">
            <a href="#" class="header__title">DevOps Tracker - Debug Mode</a>
            <nav class="header__nav">
                <div class="header__controls">
                    <button class="btn btn--outline btn--sm" id="signInBtn">Sign In</button>
                    <button class="btn btn--primary btn--sm" id="signUpBtn">Sign Up</button>
                    <button class="btn btn--outline btn--sm hidden" id="signOutBtn">Sign Out</button>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="setup-guide">
                <h3>ðŸ”§ Supabase Setup & Debugging Guide</h3>
                <div class="setup-guide-content">

                    <div class="alert info">
                        <strong>Debug Mode Active:</strong> This version provides detailed debugging information to help you set up Supabase correctly. Check the debug panel in the bottom right corner for real-time status updates.
                    </div>

                    <div class="setup-step">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">Create Supabase Project</div>
                        </div>
                        <p>1. Go to <a href="https://supabase.com" target="_blank">supabase.com</a> and create a new project</p>
                        <p>2. Wait for the project to be fully provisioned (2-3 minutes)</p>
                        <p>3. Note your project URL and anon key from the API settings</p>
                    </div>

                    <div class="setup-step">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div class="step-title">Configure Database</div>
                        </div>
                        <p>Run this SQL script in your Supabase SQL Editor:</p>
                        <div class="code-block">-- Create user_progress table
CREATE TABLE IF NOT EXISTS user_progress (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users NOT NULL,
  topic_data JSONB NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE user_progress ENABLE ROW LEVEL SECURITY;

-- Create policies
CREATE POLICY "Users can view own progress" ON user_progress
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own progress" ON user_progress
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own progress" ON user_progress
  FOR UPDATE USING (auth.uid() = user_id);

-- Create index
CREATE INDEX IF NOT EXISTS user_progress_user_id_idx ON user_progress(user_id);</div>
                    </div>

                    <div class="setup-step">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div class="step-title">Configure Authentication</div>
                        </div>
                        <p>1. Go to Authentication â†’ Settings in your Supabase dashboard</p>
                        <p>2. Set Site URL to your GitHub Pages URL (e.g., <span class="code-inline">https://vikasops.github.io/Prep_Tracker/</span>)</p>
                        <p>3. Enable email confirmations (recommended)</p>
                    </div>

                    <div class="setup-step">
                        <div class="step-header">
                            <div class="step-number">4</div>
                            <div class="step-title">Update Code Credentials</div>
                        </div>
                        <p>Replace these values in the JavaScript code:</p>
                        <div class="code-block">const SUPABASE_URL = 'https://ffkmdzknroalcmhpftcj.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZma21kemtucm9hbGNtaHBmdGNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1ODE4NTMsImV4cCI6MjA3NTE1Nzg1M30.d3y4HhyRfElwb54WGXuz2DsSEDujQo6_prD4vP3voxs';</div>

                        <div class="alert warning">
                            <strong>Current Status:</strong> <span id="currentConfigStatus">Configuration not detected</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
// Supabase configuration - REPLACE WITH YOUR ACTUAL VALUES
const SUPABASE_URL = 'https://ffkmdzknroalcmhpftcj.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZma21kemtucm9hbGNtaHBmdGNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1ODE4NTMsImV4cCI6MjA3NTE1Nzg1M30.d3y4HhyRfElwb54WGXuz2DsSEDujQo6_prD4vP3voxs';

// Debug logging
class DebugLogger {
    constructor() {
        this.logs = [];
        this.maxLogs = 100;
    }

    log(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = { timestamp, message, type };
        this.logs.push(logEntry);

        if (this.logs.length > this.maxLogs) {
            this.logs.shift();
        }

        this.updateDebugPanel();
        console.log(`[${type.toUpperCase()}] ${message}`);
    }

    error(message) {
        this.log(message, 'error');
    }

    warn(message) {
        this.log(message, 'warning');
    }

    success(message) {
        this.log(message, 'success');
    }

    clear() {
        this.logs = [];
        this.updateDebugPanel();
    }

    updateDebugPanel() {
        const debugLogs = document.getElementById('debugLogs');
        if (debugLogs) {
            debugLogs.innerHTML = this.logs.slice(-10).map(log => 
                `<div style="color: ${this.getLogColor(log.type)};">[${log.timestamp}] ${log.message}</div>`
            ).join('');
            debugLogs.scrollTop = debugLogs.scrollHeight;
        }
    }

    getLogColor(type) {
        switch (type) {
            case 'error': return '#ff6b6b';
            case 'warning': return '#ffa726';
            case 'success': return '#66bb6a';
            default: return '#e2e8f0';
        }
    }
}

const logger = new DebugLogger();

// Check if demo mode
const DEMO_MODE = SUPABASE_URL === 'https://ffkmdzknroalcmhpftcj.supabase.co' || SUPABASE_ANON_KEY === 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZma21kemtucm9hbGNtaHBmdGNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1ODE4NTMsImV4cCI6MjA3NTE1Nzg1M30.d3y4HhyRfElwb54WGXuz2DsSEDujQo6_prD4vP3voxs';

// Initialize Supabase client
let supabase = null;
if (!DEMO_MODE) {
    try {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        logger.success('Supabase client initialized successfully');
    } catch (error) {
        logger.error('Failed to initialize Supabase client: ' + error.message);
    }
}

// Debug status updater
class DebugStatus {
    constructor() {
        this.updateConfigStatus();
        this.updateSupabaseStatus();
    }

    updateConfigStatus() {
        const status = document.getElementById('configStatus');
        const value = document.getElementById('configValue');
        const current = document.getElementById('currentConfigStatus');

        if (DEMO_MODE) {
            status.className = 'debug-item warning';
            value.textContent = 'Demo Mode - Credentials needed';
            if (current) current.textContent = 'Demo mode active - please configure credentials';
            logger.warn('Running in demo mode - Supabase credentials not configured');
        } else {
            status.className = 'debug-item success';
            value.textContent = 'Configured';
            if (current) current.textContent = 'Credentials configured correctly';
            logger.success('Supabase credentials configured');
        }
    }

    async updateSupabaseStatus() {
        const status = document.getElementById('supabaseStatus');
        const value = document.getElementById('supabaseValue');

        if (DEMO_MODE) {
            status.className = 'debug-item warning';
            value.textContent = 'Demo mode';
            return;
        }

        try {
            // Test basic connection
            const { data, error } = await supabase.auth.getSession();

            if (error) {
                status.className = 'debug-item error';
                value.textContent = 'Connection failed: ' + error.message;
                logger.error('Supabase connection failed: ' + error.message);
            } else {
                status.className = 'debug-item success';
                value.textContent = 'Connected';
                logger.success('Supabase connection established');
            }
        } catch (error) {
            status.className = 'debug-item error';
            value.textContent = 'Connection error: ' + error.message;
            logger.error('Supabase connection error: ' + error.message);
        }
    }

    updateAuthStatus(user) {
        const status = document.getElementById('authStatus');
        const value = document.getElementById('authValue');

        if (user) {
            status.className = 'debug-item success';
            value.textContent = `Authenticated: ${user.email}`;
            logger.success(`User authenticated: ${user.email}`);
        } else {
            status.className = 'debug-item';
            value.textContent = 'Not authenticated';
        }
    }

    async updateDatabaseStatus() {
        const status = document.getElementById('databaseStatus');
        const value = document.getElementById('databaseValue');

        if (DEMO_MODE) {
            status.className = 'debug-item warning';
            value.textContent = 'Demo mode - no database';
            return;
        }

        if (!supabase) {
            status.className = 'debug-item error';
            value.textContent = 'Supabase not initialized';
            return;
        }

        try {
            // Test table existence and RLS
            const { data, error } = await supabase
                .from('user_progress')
                .select('count', { count: 'exact', head: true });

            if (error) {
                if (error.code === '42P01') {
                    status.className = 'debug-item error';
                    value.textContent = 'Table not found - run SQL script';
                    logger.error('user_progress table does not exist');
                } else if (error.code === '42501') {
                    status.className = 'debug-item error';
                    value.textContent = 'Permission denied - check RLS policies';
                    logger.error('RLS policies not configured correctly');
                } else {
                    status.className = 'debug-item error';
                    value.textContent = 'Database error: ' + error.message;
                    logger.error('Database error: ' + error.message);
                }
            } else {
                status.className = 'debug-item success';
                value.textContent = 'Table accessible';
                logger.success('Database table accessible');
            }
        } catch (error) {
            status.className = 'debug-item error';
            value.textContent = 'Test failed: ' + error.message;
            logger.error('Database test failed: ' + error.message);
        }
    }
}

// Main application
class DevOpsTracker {
    constructor() {
        this.user = null;
        this.isSignUp = false;
        this.debugStatus = new DebugStatus();

        logger.log('DevOps Tracker initialized');
        this.init();
    }

    async init() {
        logger.log('Initializing application...');

        this.bindEvents();
        this.bindAuthEvents();
        this.bindDebugEvents();

        if (!DEMO_MODE) {
            await this.checkAuthState();
        }

        logger.success('Application initialized');
    }

    async checkAuthState() {
        if (!supabase) {
            logger.error('Cannot check auth state - Supabase not initialized');
            return;
        }

        try {
            logger.log('Checking authentication state...');
            const { data: { session }, error } = await supabase.auth.getSession();

            if (error) {
                logger.error('Error getting session: ' + error.message);
                return;
            }

            if (session?.user) {
                logger.success('User session found: ' + session.user.email);
                this.user = session.user;
                this.debugStatus.updateAuthStatus(this.user);
                this.updateUI();
            } else {
                logger.log('No active user session');
            }

            // Listen for auth changes
            supabase.auth.onAuthStateChange(async (event, session) => {
                logger.log('Auth state changed: ' + event);

                if (event === 'SIGNED_IN' && session?.user) {
                    this.user = session.user;
                    this.debugStatus.updateAuthStatus(this.user);
                    this.updateUI();
                    await this.testDatabaseAccess();
                } else if (event === 'SIGNED_OUT') {
                    this.user = null;
                    this.debugStatus.updateAuthStatus(null);
                    this.updateUI();
                }
            });

        } catch (error) {
            logger.error('Error checking auth state: ' + error.message);
        }
    }

    async testDatabaseAccess() {
        if (!this.user || !supabase) return;

        try {
            logger.log('Testing database access for authenticated user...');

            // Try to read user's progress
            const { data, error } = await supabase
                .from('user_progress')
                .select('*')
                .eq('user_id', this.user.id);

            if (error) {
                logger.error('Database read failed: ' + error.message);
            } else {
                logger.success(`Database read successful - found ${data.length} records`);

                // Try to write if no data exists
                if (data.length === 0) {
                    logger.log('No existing data, testing write access...');
                    const testData = [{
                        id: 'test',
                        name: 'Test Topic',
                        description: 'Test',
                        subtopics: []
                    }];

                    const { error: writeError } = await supabase
                        .from('user_progress')
                        .insert({
                            user_id: this.user.id,
                            topic_data: testData
                        });

                    if (writeError) {
                        logger.error('Database write failed: ' + writeError.message);
                    } else {
                        logger.success('Database write successful');
                    }
                }
            }
        } catch (error) {
            logger.error('Database test error: ' + error.message);
        }
    }

    updateUI() {
        const signInBtn = document.getElementById('signInBtn');
        const signUpBtn = document.getElementById('signUpBtn');
        const signOutBtn = document.getElementById('signOutBtn');

        if (this.user) {
            signInBtn.classList.add('hidden');
            signUpBtn.classList.add('hidden');
            signOutBtn.classList.remove('hidden');
        } else {
            signInBtn.classList.remove('hidden');
            signUpBtn.classList.remove('hidden');
            signOutBtn.classList.add('hidden');
        }
    }

    bindDebugEvents() {
        // Debug panel toggle
        document.getElementById('debugToggle').addEventListener('click', () => {
            const content = document.getElementById('debugContent');
            const toggle = document.getElementById('debugToggle');

            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.textContent = 'âˆ’';
            } else {
                content.classList.add('collapsed');
                toggle.textContent = '+';
            }
        });

        // Test connection
        document.getElementById('testConnectionBtn').addEventListener('click', async () => {
            await this.debugStatus.updateSupabaseStatus();
        });

        // Test table
        document.getElementById('testTableBtn').addEventListener('click', async () => {
            await this.debugStatus.updateDatabaseStatus();
        });

        // Clear logs
        document.getElementById('clearLogsBtn').addEventListener('click', () => {
            logger.clear();
        });
    }

    bindAuthEvents() {
        // Form submission
        document.getElementById('authForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleAuth(e);
        });

        // Auth mode switching
        document.getElementById('authSwitchBtn').addEventListener('click', (e) => {
            e.preventDefault();
            this.toggleAuthMode();
        });

        // Show auth modal buttons
        document.getElementById('signInBtn').addEventListener('click', (e) => {
            e.preventDefault();
            this.showAuthModal('signin');
        });

        document.getElementById('signUpBtn').addEventListener('click', (e) => {
            e.preventDefault();
            this.showAuthModal('signup');
        });

        // Sign out
        document.getElementById('signOutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            this.signOut();
        });
    }

    showAuthModal(mode = 'signin') {
        this.isSignUp = mode === 'signup';
        this.updateAuthModalMode();

        const modal = document.getElementById('authModal');
        modal.classList.remove('hidden');

        setTimeout(() => {
            document.getElementById('email').focus();
        }, 100);
    }

    updateAuthModalMode() {
        const authTitle = document.getElementById('authTitle');
        const authSubmit = document.getElementById('authSubmit');
        const authSwitchText = document.getElementById('authSwitchText');
        const authSwitchBtn = document.getElementById('authSwitchBtn');
        const nameGroup = document.getElementById('nameGroup');

        if (this.isSignUp) {
            authTitle.textContent = 'Create Account';
            authSubmit.textContent = 'Sign Up';
            authSwitchText.textContent = 'Already have an account?';
            authSwitchBtn.textContent = 'Sign In';
            nameGroup.classList.remove('hidden');
        } else {
            authTitle.textContent = 'Sign In';
            authSubmit.textContent = 'Sign In';
            authSwitchText.textContent = "Don't have an account?";
            authSwitchBtn.textContent = 'Sign Up';
            nameGroup.classList.add('hidden');
        }
    }

    toggleAuthMode() {
        this.isSignUp = !this.isSignUp;
        this.updateAuthModalMode();
        this.clearAuthMessages();
    }

    async handleAuth(e) {
        e.preventDefault();

        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const fullName = document.getElementById('fullName').value.trim();

        logger.log(`Attempting to ${this.isSignUp ? 'sign up' : 'sign in'} user: ${email}`);

        // Demo mode
        if (DEMO_MODE) {
            logger.warn('Demo mode - simulating authentication');
            this.user = { email: email, id: 'demo-user-' + Date.now() };
            this.debugStatus.updateAuthStatus(this.user);
            this.updateUI();
            document.getElementById('authModal').classList.add('hidden');
            return;
        }

        if (!supabase) {
            const error = 'Supabase not initialized';
            logger.error(error);
            this.showAuthMessage('error', error);
            return;
        }

        // Validation
        if (!email || !password) {
            this.showAuthMessage('error', 'Please fill in all required fields');
            return;
        }

        if (password.length < 6) {
            this.showAuthMessage('error', 'Password must be at least 6 characters');
            return;
        }

        if (this.isSignUp && !fullName) {
            this.showAuthMessage('error', 'Please enter your full name');
            return;
        }

        this.clearAuthMessages();

        const submitBtn = document.getElementById('authSubmit');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = this.isSignUp ? 'Creating Account...' : 'Signing In...';
        submitBtn.disabled = true;

        try {
            if (this.isSignUp) {
                logger.log('Calling supabase.auth.signUp...');
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: fullName
                        }
                    }
                });

                if (error) throw error;

                if (data?.user && !data.session) {
                    logger.success('Sign up successful - verification email sent');
                    this.showAuthMessage('success', 'Account created! Please check your email for the verification link.');
                    return;
                } else if (data?.session) {
                    logger.success('Sign up successful with immediate session');
                }
            } else {
                logger.log('Calling supabase.auth.signInWithPassword...');
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;
                logger.success('Sign in successful');
            }

        } catch (error) {
            logger.error('Authentication error: ' + error.message);
            let errorMessage = error.message;

            if (errorMessage.includes('Invalid login credentials')) {
                errorMessage = 'Invalid email or password. Please check your credentials.';
            } else if (errorMessage.includes('Email not confirmed')) {
                errorMessage = 'Please verify your email address before signing in.';
            } else if (errorMessage.includes('User already registered')) {
                errorMessage = 'An account with this email already exists. Try signing in instead.';
            }

            this.showAuthMessage('error', errorMessage);
        } finally {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    }

    async signOut() {
        logger.log('Signing out user...');

        if (DEMO_MODE) {
            this.user = null;
            this.debugStatus.updateAuthStatus(null);
            this.updateUI();
            logger.success('Demo user signed out');
            return;
        }

        if (!supabase) {
            logger.error('Cannot sign out - Supabase not initialized');
            return;
        }

        try {
            const { error } = await supabase.auth.signOut();
            if (error) throw error;

            logger.success('User signed out successfully');
        } catch (error) {
            logger.error('Sign out error: ' + error.message);
            alert('Failed to sign out. Please try again.');
        }
    }

    showAuthMessage(type, message) {
        const errorEl = document.getElementById('authError');
        const successEl = document.getElementById('authSuccess');

        if (type === 'error') {
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
            successEl.classList.add('hidden');
        } else {
            successEl.textContent = message;
            successEl.classList.remove('hidden');
            errorEl.classList.add('hidden');
        }
    }

    clearAuthMessages() {
        const errorEl = document.getElementById('authError');
        const successEl = document.getElementById('authSuccess');
        errorEl.textContent = '';
        successEl.textContent = '';
        errorEl.classList.add('hidden');
        successEl.classList.add('hidden');
    }

    bindEvents() {
        // Additional event bindings would go here
    }
}

// Initialize the application
document.addEventListener('DOMContentLoaded', () => {
    logger.log('DOM loaded, starting application...');

    try {
        window.tracker = new DevOpsTracker();
    } catch (error) {
        logger.error('Failed to initialize application: ' + error.message);
        alert('Failed to load DevOps Tracker. Check the debug console for details.');
    }
});
    </script>
</body>
</html>
