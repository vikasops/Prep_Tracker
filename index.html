<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps Preparation Tracker - Multi-User</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
:root {
  --color-primary: #2563eb;
  --color-primary-light: #3b82f6;
  --color-secondary: #64748b;
  --color-success: #10b981;
  --color-warning: #f59e0b;
  --color-danger: #ef4444;
  --color-background: #f8fafc;
  --color-surface: #ffffff;
  --color-border: #e2e8f0;
  --color-text: #1e293b;
  --color-text-muted: #64748b;
  --border-radius: 8px;
  --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  --transition: all 0.2s ease-in-out;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  line-height: 1.6;
  color: var(--color-text);
  background-color: var(--color-background);
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
}

/* Header */
.header {
  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
  color: white;
  padding: 1.5rem 0;
  box-shadow: var(--shadow);
}

.header .container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.header__title {
  font-size: 1.75rem;
  font-weight: 700;
  margin: 0;
}

.header__controls {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  align-items: center;
}

.user-info {
  background: rgba(255, 255, 255, 0.1);
  padding: 0.5rem 1rem;
  border-radius: var(--border-radius);
  font-size: 0.875rem;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: var(--border-radius);
  font-size: 0.875rem;
  font-weight: 500;
  text-decoration: none;
  cursor: pointer;
  transition: var(--transition);
  white-space: nowrap;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.btn--sm {
  padding: 0.375rem 0.75rem;
  font-size: 0.8rem;
}

.btn--secondary {
  background: rgba(255, 255, 255, 0.2);
  color: white;
}

.btn--secondary:hover:not(:disabled) {
  background: rgba(255, 255, 255, 0.3);
}

.btn--outline {
  background: transparent;
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.btn--outline:hover:not(:disabled) {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(255, 255, 255, 0.5);
}

.btn--primary {
  background: var(--color-primary);
  color: white;
}

.btn--primary:hover:not(:disabled) {
  background: var(--color-primary-light);
}

.btn--danger {
  background: var(--color-danger);
  color: white;
}

.btn--danger:hover:not(:disabled) {
  background: #dc2626;
}

.btn-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.5rem;
  border: none;
  background: transparent;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: var(--transition);
}

.btn-icon:hover {
  background-color: var(--color-border);
}

/* Auth Modal */
.auth-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(4px);
}

.auth-modal.hidden {
  display: none;
}

.auth-form {
  background: white;
  padding: 2rem;
  border-radius: var(--border-radius);
  box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 400px;
  margin: 1rem;
  position: relative;
}

.auth-form h2 {
  margin-bottom: 1.5rem;
  text-align: center;
  color: var(--color-text);
  font-size: 1.5rem;
}

.form-group {
  margin-bottom: 1rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--color-text);
}

.form-control {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius);
  font-size: 1rem;
  transition: var(--transition);
}

.form-control:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.error {
  color: var(--color-danger);
  font-size: 0.875rem;
  margin-top: 0.5rem;
  padding: 0.5rem;
  background: rgba(239, 68, 68, 0.1);
  border-radius: var(--border-radius);
  border-left: 4px solid var(--color-danger);
}

.success {
  color: var(--color-success);
  font-size: 0.875rem;
  margin-top: 0.5rem;
  padding: 0.5rem;
  background: rgba(16, 185, 129, 0.1);
  border-radius: var(--border-radius);
  border-left: 4px solid var(--color-success);
}

.auth-switch {
  text-align: center;
  margin-top: 1.5rem;
  font-size: 0.875rem;
  padding-top: 1rem;
  border-top: 1px solid var(--color-border);
}

.auth-switch button {
  background: none;
  border: none;
  color: var(--color-primary);
  cursor: pointer;
  font-weight: 500;
  text-decoration: none;
  margin-left: 0.25rem;
}

.auth-switch button:hover {
  text-decoration: underline;
}

.close-modal {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  border: none;
  font-size: 1.5rem;
  color: var(--color-text-muted);
  cursor: pointer;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.close-modal:hover {
  background: var(--color-border);
}

/* Main Content */
.main {
  padding: 2rem 0;
}

/* Cards */
.card {
  background: var(--color-surface);
  border-radius: var(--border-radius);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow);
  margin-bottom: 1.5rem;
}

.card__header {
  padding: 1.25rem;
  border-bottom: 1px solid var(--color-border);
}

.card__body {
  padding: 1.25rem;
}

/* Progress Overview */
.progress-overview h2 {
  margin-bottom: 1rem;
  color: var(--color-text);
  font-size: 1.25rem;
}

.progress-bar-container {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.progress-bar {
  flex: 1;
  height: 12px;
  background-color: var(--color-border);
  border-radius: 6px;
  overflow: hidden;
}

.progress-bar__fill {
  height: 100%;
  background: linear-gradient(90deg, var(--color-success) 0%, var(--color-primary) 100%);
  transition: width 0.3s ease;
  width: 0%;
}

.progress-percentage {
  font-weight: 600;
  font-size: 1.1rem;
  color: var(--color-primary);
  min-width: 4rem;
}

.progress-stats {
  display: flex;
  justify-content: space-between;
  font-size: 0.875rem;
  color: var(--color-text-muted);
}

/* Search */
.search-section {
  margin-bottom: 2rem;
}

/* Topic Sections */
.topic-section {
  margin-bottom: 1rem;
}

.topic-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  transition: var(--transition);
  padding: 1rem 1.25rem;
}

.topic-header:hover {
  background-color: #f9fafb;
}

.topic-header__left {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex: 1;
}

.topic-header__right {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.topic-toggle {
  color: var(--color-secondary);
}

.topic-toggle[aria-expanded="true"] .chevron-icon {
  transform: rotate(90deg);
}

.chevron-icon {
  transition: transform 0.2s ease;
  width: 20px;
  height: 20px;
}

.topic-info {
  flex: 1;
}

.topic-title {
  font-size: 1.125rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
  color: var(--color-text);
}

.topic-description {
  font-size: 0.875rem;
  color: var(--color-text-muted);
  margin: 0;
}

.progress-indicator {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
}

.progress-circle {
  position: relative;
  width: 40px;
  height: 40px;
}

.progress-ring {
  transform: rotate(-90deg);
}

.progress-ring__circle {
  stroke: var(--color-primary);
  stroke-dasharray: 113;
  stroke-dashoffset: 113;
  transition: stroke-dashoffset 0.3s ease;
}

.progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 0.65rem;
  font-weight: 600;
  color: var(--color-primary);
}

.progress-stats-small {
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

/* Topic Content */
.topic-content {
  border-top: 1px solid var(--color-border);
  padding: 0;
}

.subtopics-list {
  padding: 0;
}

.subtopic-item {
  padding: 1rem 1.25rem;
  border-bottom: 1px solid #f1f5f9;
  transition: var(--transition);
}

.subtopic-item:last-child {
  border-bottom: none;
}

.subtopic-item:hover {
  background-color: #fafbfc;
}

.subtopic-item.completed {
  background-color: rgba(16, 185, 129, 0.05);
}

.subtopic-item.completed .subtopic-name {
  text-decoration: line-through;
  color: var(--color-text-muted);
}

.subtopic-header {
  margin-bottom: 0.75rem;
}

.checkbox-label {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  cursor: pointer;
  font-size: 0.95rem;
}

.checkbox-label input[type="checkbox"] {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

.checkbox-custom {
  width: 18px;
  height: 18px;
  border: 2px solid var(--color-border);
  border-radius: 3px;
  background: var(--color-surface);
  transition: var(--transition);
  position: relative;
  flex-shrink: 0;
  margin-top: 2px;
}

.checkbox-label input[type="checkbox"]:checked + .checkbox-custom {
  background: var(--color-success);
  border-color: var(--color-success);
}

.checkbox-label input[type="checkbox"]:checked + .checkbox-custom::after {
  content: '‚úì';
  position: absolute;
  color: white;
  font-size: 12px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.subtopic-name {
  flex: 1;
  font-weight: 500;
}

.subtopic-comments {
  margin-left: 2.5rem;
}

.subtopic-comments textarea {
  width: 100%;
  min-height: 60px;
  padding: 0.5rem;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius);
  font-size: 0.875rem;
  resize: vertical;
  transition: var(--transition);
}

.subtopic-comments textarea:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.text-muted {
  color: var(--color-text-muted);
  font-size: 0.75rem;
  margin-top: 0.25rem;
  display: block;
}

/* Loading state */
.loading {
  text-align: center;
  padding: 2rem;
  color: var(--color-text-muted);
}

.sync-status {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.5rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 500;
}

.sync-status.synced {
  background: rgba(16, 185, 129, 0.1);
  color: var(--color-success);
}

.sync-status.syncing {
  background: rgba(245, 158, 11, 0.1);
  color: var(--color-warning);
}

.sync-status.error {
  background: rgba(239, 68, 68, 0.1);
  color: var(--color-danger);
}

/* Footer */
.footer {
  margin-top: 3rem;
  padding-top: 2rem;
  border-top: 1px solid var(--color-border);
}

.footer-content {
  text-align: center;
  color: var(--color-text-muted);
  font-size: 0.875rem;
}

.footer-content p {
  margin-bottom: 0.5rem;
}

.footer-links a {
  color: var(--color-primary);
  text-decoration: none;
}

.footer-links a:hover {
  text-decoration: underline;
}

/* Responsive Design */
@media (max-width: 768px) {
  .header .container {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
  }

  .header__controls {
    justify-content: center;
    flex-wrap: wrap;
  }

  .topic-header {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
  }

  .topic-header__right {
    justify-content: center;
  }

  .progress-bar-container {
    flex-direction: column;
    align-items: stretch;
    gap: 0.5rem;
  }

  .progress-percentage {
    text-align: center;
  }

  .progress-stats {
    flex-direction: column;
    text-align: center;
    gap: 0.25rem;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 0 0.75rem;
  }

  .header__title {
    font-size: 1.5rem;
  }

  .card__header,
  .card__body {
    padding: 1rem;
  }

  .subtopic-item {
    padding: 0.75rem 1rem;
  }

  .subtopic-comments {
    margin-left: 1.75rem;
  }

  .auth-form {
    margin: 0.5rem;
    padding: 1.5rem;
  }
}
    </style>
</head>
<body>
    <!-- Authentication Modal -->
    <div class="auth-modal hidden" id="authModal">
        <div class="auth-form">
            <button class="close-modal" id="closeModal" type="button">&times;</button>
            <h2 id="authTitle">Welcome Back</h2>
            <form id="authForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" class="form-control" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" required placeholder="Enter your password">
                </div>
                <div class="form-group" id="nameGroup" style="display: none;">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" class="form-control" placeholder="Enter your full name">
                </div>
                <div id="authError" class="error" style="display: none;"></div>
                <div id="authSuccess" class="success" style="display: none;"></div>
                <div class="form-group">
                    <button type="submit" class="btn btn--primary" style="width: 100%;" id="authSubmit">
                        Sign In
                    </button>
                </div>
                <div class="auth-switch">
                    <span id="authSwitchText">Don't have an account?</span>
                    <button type="button" id="authSwitchBtn">Sign Up</button>
                </div>
            </form>
        </div>
    </div>

    <header class="header">
        <div class="container">
            <h1 class="header__title">üöÄ DevOps Preparation Tracker</h1>
            <div class="header__controls">
                <div class="sync-status synced" id="syncStatus">
                    <span>‚óè</span>
                    <span>Ready</span>
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    üë§ <span id="userEmail"></span>
                </div>
                <button class="btn btn--secondary btn--sm" id="expandAllBtn" style="display: none;">
                    <span id="expandAllText">Expand All</span>
                </button>
                <button class="btn btn--outline btn--sm" id="exportBtn" style="display: none;">üìä Export Progress</button>
                <button class="btn btn--outline btn--sm" id="signInBtn">üîê Sign In</button>
                <button class="btn btn--danger btn--sm" id="signOutBtn" style="display: none;">üö™ Sign Out</button>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- Welcome Section -->
            <section class="welcome-section" id="welcomeSection">
                <div class="card">
                    <div class="card__body">
                        <h2>üëã Welcome to DevOps Preparation Tracker</h2>
                        <p style="margin-bottom: 1rem;">Track your DevOps interview preparation across 8 key technology areas with 80 comprehensive topics. Your progress is saved in the cloud and synced across all your devices.</p>
                        <p style="margin-bottom: 1.5rem; font-size: 0.9rem; color: var(--color-text-muted);">
                            ‚úÖ Multi-user support with secure authentication<br>
                            ‚úÖ Cloud storage with automatic sync<br>
                            ‚úÖ Progress tracking across all devices<br>
                            ‚úÖ Private data for each user
                        </p>
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn--primary" id="getStartedBtn">üöÄ Get Started</button>
                            <button class="btn btn--outline" id="learnMoreBtn" style="color: var(--color-primary); border-color: var(--color-primary);">üìñ Learn More</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Overall Progress Section -->
            <section class="progress-overview" id="progressSection" style="display: none;">
                <div class="card">
                    <div class="card__body">
                        <h2>üìà Overall Progress</h2>
                        <div class="progress-bar-container">
                            <div class="progress-bar">
                                <div class="progress-bar__fill" id="overallProgressFill"></div>
                            </div>
                            <span class="progress-percentage" id="overallProgressText">0%</span>
                        </div>
                        <div class="progress-stats">
                            <span id="completedStats">0 of 80 topics completed</span>
                            <span id="lastUpdated">Last updated: Never</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Search Section -->
            <section class="search-section" id="searchSection" style="display: none;">
                <div class="form-group">
                    <input type="text" class="form-control" id="searchInput" 
                           placeholder="üîç Search topics (e.g., Docker, Kubernetes, CI/CD...)">
                </div>
            </section>

            <!-- Topics Section -->
            <section class="topics-section" id="topicsSection" style="display: none;">
                <div id="topicsContainer">
                    <div class="loading">Loading DevOps topics...</div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="footer">
                <div class="footer-content">
                    <p>üí° <strong>Multi-User DevOps Tracker:</strong> Your progress is automatically saved to the cloud and synced across devices!</p>
                    <p class="footer-links">
                        <a href="https://github.com" target="_blank">GitHub</a> ‚Ä¢
                        <a href="https://kubernetes.io/docs" target="_blank">Kubernetes Docs</a> ‚Ä¢
                        <a href="https://terraform.io/docs" target="_blank">Terraform Docs</a> ‚Ä¢
                        <a href="https://supabase.com" target="_blank">Powered by Supabase</a>
                    </p>
                </div>
            </footer>
        </div>
    </main>

    <script>
// Supabase configuration - REPLACE WITH YOUR ACTUAL VALUES
const SUPABASE_URL = 'https://ffkmdzknroalcmhpftcj.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZma21kemtucm9hbGNtaHBmdGNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1ODE4NTMsImV4cCI6MjA3NTE1Nzg1M30.d3y4HhyRfElwb54WGXuz2DsSEDujQo6_prD4vP3voxs';

// Check if demo mode (no credentials provided)
const DEMO_MODE = SUPABASE_URL === 'https://ffkmdzknroalcmhpftcj.supabase.co' || SUPABASE_ANON_KEY === 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZma21kemtucm9hbGNtaHBmdGNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1ODE4NTMsImV4cCI6MjA3NTE1Nzg1M30.d3y4HhyRfElwb54WGXuz2DsSEDujQo6_prD4vP3voxs';

// Initialize Supabase client (only if not in demo mode)
let supabase = null;
if (!DEMO_MODE) {
    try {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('Supabase client initialized successfully');
    } catch (error) {
        console.error('Failed to initialize Supabase client:', error);
    }
}

// DevOps Preparation Tracker with Supabase Integration
class DevOpsTracker {
    constructor() {
        this.user = null;
        this.isSignUp = false;
        this.demoMode = DEMO_MODE;

        this.data = {
            "topics": [
                {
                    "id": "terraform",
                    "name": "Terraform",
                    "description": "Infrastructure as Code with Terraform",
                    "subtopics": [
                        {"id": "terraform-basics", "name": "Terraform Basics & Architecture", "completed": false, "comments": ""},
                        {"id": "iac-concepts", "name": "Infrastructure as Code (IaC) Concepts", "completed": false, "comments": ""},
                        {"id": "terraform-commands", "name": "Terraform Commands & CLI", "completed": false, "comments": ""},
                        {"id": "state-management", "name": "State Management & Remote State", "completed": false, "comments": ""},
                        {"id": "terraform-modules", "name": "Modules & Module Development", "completed": false, "comments": ""},
                        {"id": "variables-datasources", "name": "Variables & Data Sources", "completed": false, "comments": ""},
                        {"id": "providers", "name": "Providers & Provider Configuration", "completed": false, "comments": ""},
                        {"id": "workspaces", "name": "Terraform Workspaces", "completed": false, "comments": ""},
                        {"id": "terraform-security", "name": "Best Practices & Security", "completed": false, "comments": ""},
                        {"id": "terraform-scenarios", "name": "Scenario-Based Questions", "completed": false, "comments": ""}
                    ]
                },
                {
                    "id": "linux", 
                    "name": "Linux",
                    "description": "Linux System Administration & Operations",
                    "subtopics": [
                        {"id": "linux-fundamentals", "name": "Linux Fundamentals & Architecture", "completed": false, "comments": ""},
                        {"id": "file-system", "name": "File System & Directory Structure", "completed": false, "comments": ""},
                        {"id": "command-line", "name": "Command Line & Shell Scripting", "completed": false, "comments": ""},
                        {"id": "process-management", "name": "Process Management", "completed": false, "comments": ""},
                        {"id": "system-admin", "name": "System Administration", "completed": false, "comments": ""},
                        {"id": "network-config", "name": "Network Configuration", "completed": false, "comments": ""},
                        {"id": "security-permissions", "name": "Security & Permissions", "completed": false, "comments": ""},
                        {"id": "package-management", "name": "Package Management", "completed": false, "comments": ""},
                        {"id": "system-monitoring", "name": "System Monitoring & Troubleshooting", "completed": false, "comments": ""},
                        {"id": "performance-tuning", "name": "Performance Tuning", "completed": false, "comments": ""}
                    ]
                },
                {
                    "id": "kubernetes",
                    "name": "Kubernetes", 
                    "description": "Container Orchestration with Kubernetes",
                    "subtopics": [
                        {"id": "k8s-architecture", "name": "Kubernetes Architecture & Components", "completed": false, "comments": ""},
                        {"id": "pods-deployments", "name": "Pods, Deployments & Services", "completed": false, "comments": ""},
                        {"id": "configmaps-secrets", "name": "ConfigMaps & Secrets", "completed": false, "comments": ""},
                        {"id": "storage-pv", "name": "Storage & Persistent Volumes", "completed": false, "comments": ""},
                        {"id": "k8s-networking", "name": "Networking & Ingress", "completed": false, "comments": ""},
                        {"id": "rbac-security", "name": "RBAC & Security", "completed": false, "comments": ""},
                        {"id": "monitoring-logging", "name": "Monitoring & Logging", "completed": false, "comments": ""},
                        {"id": "helm", "name": "Helm & Package Management", "completed": false, "comments": ""},
                        {"id": "k8s-troubleshooting", "name": "Troubleshooting & Debugging", "completed": false, "comments": ""},
                        {"id": "k8s-best-practices", "name": "Best Practices & Scenarios", "completed": false, "comments": ""}
                    ]
                },
                {
                    "id": "jenkins",
                    "name": "Jenkins",
                    "description": "CI/CD Automation with Jenkins", 
                    "subtopics": [
                        {"id": "jenkins-architecture", "name": "Jenkins Architecture & Setup", "completed": false, "comments": ""},
                        {"id": "pipeline-development", "name": "Pipeline Development (Declarative & Scripted)", "completed": false, "comments": ""},
                        {"id": "plugin-management", "name": "Plugin Management", "completed": false, "comments": ""},
                        {"id": "build-deployment", "name": "Build & Deployment Automation", "completed": false, "comments": ""},
                        {"id": "jenkins-security", "name": "Security & User Management", "completed": false, "comments": ""},
                        {"id": "master-slave", "name": "Master-Slave Configuration", "completed": false, "comments": ""},
                        {"id": "git-integration", "name": "Integration with Git & SCM", "completed": false, "comments": ""},
                        {"id": "docker-k8s-integration", "name": "Docker & Kubernetes Integration", "completed": false, "comments": ""},
                        {"id": "jenkins-monitoring", "name": "Monitoring & Troubleshooting", "completed": false, "comments": ""},
                        {"id": "jenkins-best-practices", "name": "Best Practices", "completed": false, "comments": ""}
                    ]
                },
                {
                    "id": "github",
                    "name": "GitHub",
                    "description": "Version Control & GitHub Workflows",
                    "subtopics": [
                        {"id": "git-fundamentals", "name": "Git Fundamentals & Commands", "completed": false, "comments": ""},
                        {"id": "branching-merging", "name": "Branching & Merging Strategies", "completed": false, "comments": ""},
                        {"id": "github-actions", "name": "GitHub Actions & Workflows", "completed": false, "comments": ""},
                        {"id": "pull-requests", "name": "Pull Requests & Code Review", "completed": false, "comments": ""},
                        {"id": "repo-management", "name": "Repository Management", "completed": false, "comments": ""},
                        {"id": "github-security", "name": "GitHub Security Features", "completed": false, "comments": ""},
                        {"id": "api-integrations", "name": "API & Integrations", "completed": false, "comments": ""},
                        {"id": "team-collaboration", "name": "Collaboration & Team Management", "completed": false, "comments": ""},
                        {"id": "advanced-git", "name": "Advanced Git Operations", "completed": false, "comments": ""},
                        {"id": "git-best-practices", "name": "Best Practices & Troubleshooting", "completed": false, "comments": ""}
                    ]
                },
                {
                    "id": "gitlab",
                    "name": "GitLab", 
                    "description": "GitLab CI/CD & DevOps Platform",
                    "subtopics": [
                        {"id": "gitlab-architecture", "name": "GitLab Architecture & Setup", "completed": false, "comments": ""},
                        {"id": "gitlab-cicd", "name": "GitLab CI/CD Pipelines", "completed": false, "comments": ""},
                        {"id": "runners-jobs", "name": "Runners & Job Management", "completed": false, "comments": ""},
                        {"id": "gitlab-security", "name": "Security & Access Control", "completed": false, "comments": ""},
                        {"id": "container-registry", "name": "Container Registry", "completed": false, "comments": ""},
                        {"id": "gitlab-monitoring", "name": "Monitoring & Analytics", "completed": false, "comments": ""},
                        {"id": "gitlab-api", "name": "API & Integrations", "completed": false, "comments": ""},
                        {"id": "multi-project", "name": "Multi-project Pipelines", "completed": false, "comments": ""},
                        {"id": "gitlab-vs-github", "name": "GitLab vs GitHub Comparison", "completed": false, "comments": ""},
                        {"id": "gitlab-best-practices", "name": "Best Practices", "completed": false, "comments": ""}
                    ]
                },
                {
                    "id": "argocd",
                    "name": "ArgoCD",
                    "description": "GitOps Continuous Delivery with ArgoCD",
                    "subtopics": [
                        {"id": "gitops-principles", "name": "GitOps Principles & Concepts", "completed": false, "comments": ""},
                        {"id": "argocd-architecture", "name": "ArgoCD Architecture & Components", "completed": false, "comments": ""},
                        {"id": "app-deployment", "name": "Application Deployment & Management", "completed": false, "comments": ""},
                        {"id": "sync-strategies", "name": "Sync Strategies & Policies", "completed": false, "comments": ""},
                        {"id": "multi-cluster", "name": "Multi-cluster Management", "completed": false, "comments": ""},
                        {"id": "argocd-rbac", "name": "RBAC & Security", "completed": false, "comments": ""},
                        {"id": "argocd-monitoring", "name": "Monitoring & Observability", "completed": false, "comments": ""},
                        {"id": "argocd-troubleshooting", "name": "Troubleshooting & Debugging", "completed": false, "comments": ""},
                        {"id": "cicd-integration", "name": "Integration with CI/CD", "completed": false, "comments": ""},
                        {"id": "argocd-scenarios", "name": "Best Practices & Scenarios", "completed": false, "comments": ""}
                    ]
                },
                {
                    "id": "networking",
                    "name": "Networking",
                    "description": "Network Fundamentals for DevOps",
                    "subtopics": [
                        {"id": "osi-tcpip", "name": "OSI & TCP/IP Model", "completed": false, "comments": ""},
                        {"id": "ip-subnetting", "name": "IP Addressing & Subnetting", "completed": false, "comments": ""},
                        {"id": "dns-dhcp", "name": "DNS & DHCP", "completed": false, "comments": ""},
                        {"id": "routing-switching", "name": "Routing & Switching", "completed": false, "comments": ""},
                        {"id": "load-balancing", "name": "Load Balancing & Proxies", "completed": false, "comments": ""},
                        {"id": "firewalls", "name": "Firewalls & Security", "completed": false, "comments": ""},
                        {"id": "cloud-networking", "name": "Cloud Networking (VPC, Subnets)", "completed": false, "comments": ""},
                        {"id": "container-networking", "name": "Container Networking", "completed": false, "comments": ""},
                        {"id": "network-troubleshooting", "name": "Troubleshooting Tools", "completed": false, "comments": ""},
                        {"id": "network-security", "name": "Network Security & Best Practices", "completed": false, "comments": ""}
                    ]
                }
            ]
        };

        this.allExpanded = false;

        console.log('DevOps Tracker initialized in', this.demoMode ? 'DEMO MODE' : 'PRODUCTION MODE');
        this.init();
    }

    async init() {
        console.log('Initializing tracker...');

        if (this.demoMode) {
            this.initDemoMode();
        } else {
            await this.checkAuthState();
        }

        this.bindEvents();
        this.bindAuthEvents();
        console.log('Tracker initialized successfully');
    }

    initDemoMode() {
        console.log('Running in demo mode - configure Supabase credentials for full functionality');
        this.setSyncStatus('error', 'Demo Mode');
        this.showWelcomeScreen();

        // Show demo notification in welcome section
        const welcomeSection = document.getElementById('welcomeSection');
        welcomeSection.innerHTML = `
            <div class="card">
                <div class="card__body">
                    <h2>‚öôÔ∏è Configuration Required</h2>
                    <p style="margin-bottom: 1rem;">To enable multi-user authentication and cloud storage, please configure your Supabase credentials:</p>
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; font-family: monospace; font-size: 0.9rem;">
                        <p><strong>1. Update these values in the code:</strong></p>
                        <p style="color: #dc2626;">SUPABASE_URL = 'your-project-url'</p>
                        <p style="color: #dc2626;">SUPABASE_ANON_KEY = 'your-anon-key'</p>
                    </div>
                    <p style="margin-bottom: 1.5rem; font-size: 0.9rem; color: var(--color-text-muted);">
                        üìñ <strong>Setup Instructions:</strong> Follow the complete setup guide to create your Supabase project and configure authentication.
                    </p>
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn--primary" id="tryDemoBtn">üì± Try Demo Mode</button>
                        <button class="btn btn--outline" style="color: var(--color-primary); border-color: var(--color-primary);">üìñ View Setup Guide</button>
                    </div>
                </div>
            </div>
        `;

        // Add demo mode functionality
        document.getElementById('tryDemoBtn').addEventListener('click', () => {
            this.startDemoMode();
        });
    }

    startDemoMode() {
        console.log('Starting demo mode...');
        this.user = { email: 'demo@example.com', id: 'demo-user' };
        this.showMainInterface();
        this.updateUI();
        this.renderTopics();
        this.updateProgress();
        this.setSyncStatus('syncing', 'Demo Mode');
    }

    async checkAuthState() {
        if (!supabase) return;

        try {
            const { data: { session }, error } = await supabase.auth.getSession();

            if (error) {
                console.error('Error getting session:', error);
                return;
            }

            if (session?.user) {
                console.log('User authenticated:', session.user.email);
                this.user = session.user;
                await this.onUserSignedIn();
            } else {
                console.log('No user session found');
                this.showWelcomeScreen();
            }

            // Listen for auth changes
            supabase.auth.onAuthStateChange(async (event, session) => {
                console.log('Auth state changed:', event);

                if (event === 'SIGNED_IN' && session?.user) {
                    this.user = session.user;
                    await this.onUserSignedIn();
                } else if (event === 'SIGNED_OUT') {
                    this.user = null;
                    this.onUserSignedOut();
                }
            });

        } catch (error) {
            console.error('Error checking auth state:', error);
        }
    }

    async onUserSignedIn() {
        console.log('User signed in, loading progress...');
        this.hideAuthModal();
        this.showMainInterface();
        this.updateUI();
        await this.loadProgressFromDatabase();
        this.renderTopics();
        this.updateProgress();
    }

    onUserSignedOut() {
        console.log('User signed out');
        this.showWelcomeScreen();
        this.updateUI();
        this.setSyncStatus('synced', 'Ready');
    }

    showWelcomeScreen() {
        document.getElementById('welcomeSection').style.display = 'block';
        document.getElementById('progressSection').style.display = 'none';
        document.getElementById('searchSection').style.display = 'none';
        document.getElementById('topicsSection').style.display = 'none';
    }

    showMainInterface() {
        document.getElementById('welcomeSection').style.display = 'none';
        document.getElementById('progressSection').style.display = 'block';
        document.getElementById('searchSection').style.display = 'block';
        document.getElementById('topicsSection').style.display = 'block';
    }

    updateUI() {
        const userInfo = document.getElementById('userInfo');
        const userEmail = document.getElementById('userEmail');
        const signInBtn = document.getElementById('signInBtn');
        const signOutBtn = document.getElementById('signOutBtn');
        const expandAllBtn = document.getElementById('expandAllBtn');
        const exportBtn = document.getElementById('exportBtn');

        if (this.user) {
            userInfo.style.display = 'block';
            userEmail.textContent = this.user.email;
            signInBtn.style.display = 'none';
            signOutBtn.style.display = 'inline-flex';
            expandAllBtn.style.display = 'inline-flex';
            exportBtn.style.display = 'inline-flex';
        } else {
            userInfo.style.display = 'none';
            signInBtn.style.display = 'inline-flex';
            signOutBtn.style.display = 'none';
            expandAllBtn.style.display = 'none';
            exportBtn.style.display = 'none';
        }
    }

    async loadProgressFromDatabase() {
        if (!this.user || !supabase || this.demoMode) return;

        this.setSyncStatus('syncing', 'Loading...');

        try {
            const { data, error } = await supabase
                .from('user_progress')
                .select('topic_data, updated_at')
                .eq('user_id', this.user.id)
                .single();

            if (error && error.code !== 'PGRST116') { // PGRST116 is "not found" error
                console.error('Error loading progress:', error);
                this.setSyncStatus('error', 'Load failed');
                return;
            }

            if (data?.topic_data) {
                console.log('Progress loaded from database');
                this.data.topics = data.topic_data;
                this.setSyncStatus('synced', 'Synced');
            } else {
                console.log('No progress found, creating new record');
                await this.saveProgressToDatabase();
            }

        } catch (error) {
            console.error('Error loading progress:', error);
            this.setSyncStatus('error', 'Load failed');
        }
    }

    async saveProgressToDatabase() {
        if (!this.user || !supabase || this.demoMode) return;

        this.setSyncStatus('syncing', 'Saving...');

        try {
            const { error } = await supabase
                .from('user_progress')
                .upsert({
                    user_id: this.user.id,
                    topic_data: this.data.topics,
                    updated_at: new Date().toISOString()
                });

            if (error) {
                console.error('Error saving progress:', error);
                this.setSyncStatus('error', 'Save failed');
                return;
            }

            console.log('Progress saved to database');
            this.setSyncStatus('synced', 'Synced');

        } catch (error) {
            console.error('Error saving progress:', error);
            this.setSyncStatus('error', 'Save failed');
        }
    }

    setSyncStatus(status, text) {
        const syncStatus = document.getElementById('syncStatus');
        syncStatus.className = `sync-status ${status}`;
        syncStatus.innerHTML = `<span>‚óè</span><span>${text}</span>`;
    }

    bindAuthEvents() {
        const authForm = document.getElementById('authForm');
        const authSwitchBtn = document.getElementById('authSwitchBtn');
        const signInBtn = document.getElementById('signInBtn');
        const signOutBtn = document.getElementById('signOutBtn');
        const getStartedBtn = document.getElementById('getStartedBtn');
        const learnMoreBtn = document.getElementById('learnMoreBtn');
        const closeModal = document.getElementById('closeModal');

        // Form submission
        authForm.addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleAuth(e);
        });

        // Switch between sign in / sign up
        authSwitchBtn.addEventListener('click', (e) => {
            e.preventDefault();
            this.toggleAuthMode();
        });

        // Show modal buttons
        signInBtn.addEventListener('click', (e) => {
            e.preventDefault();
            this.showAuthModal();
        });

        getStartedBtn.addEventListener('click', (e) => {
            e.preventDefault();
            this.showAuthModal();
        });

        if (learnMoreBtn) {
            learnMoreBtn.addEventListener('click', (e) => {
                e.preventDefault();
                alert('DevOps Preparation Tracker helps you systematically prepare for DevOps interviews across 8 key technology areas with progress tracking and cloud sync.');
            });
        }

        // Sign out
        signOutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            this.signOut();
        });

        // Close modal
        closeModal.addEventListener('click', (e) => {
            e.preventDefault();
            this.hideAuthModal();
        });
    }

    showAuthModal() {
        if (this.demoMode) {
            this.startDemoMode();
            return;
        }

        const modal = document.getElementById('authModal');
        modal.classList.remove('hidden');

        // Focus email field after animation
        setTimeout(() => {
            document.getElementById('email').focus();
        }, 100);
    }

    hideAuthModal() {
        const modal = document.getElementById('authModal');
        modal.classList.add('hidden');
        this.clearAuthForm();
    }

    toggleAuthMode() {
        this.isSignUp = !this.isSignUp;
        console.log('Toggling auth mode to:', this.isSignUp ? 'Sign Up' : 'Sign In');

        const authTitle = document.getElementById('authTitle');
        const authSubmit = document.getElementById('authSubmit');
        const authSwitchText = document.getElementById('authSwitchText');
        const authSwitchBtn = document.getElementById('authSwitchBtn');
        const nameGroup = document.getElementById('nameGroup');

        if (this.isSignUp) {
            authTitle.textContent = 'Create Account';
            authSubmit.textContent = 'Sign Up';
            authSwitchText.textContent = 'Already have an account?';
            authSwitchBtn.textContent = 'Sign In';
            nameGroup.style.display = 'block';
            document.getElementById('fullName').setAttribute('required', 'required');
        } else {
            authTitle.textContent = 'Welcome Back';
            authSubmit.textContent = 'Sign In';
            authSwitchText.textContent = "Don't have an account?";
            authSwitchBtn.textContent = 'Sign Up';
            nameGroup.style.display = 'none';
            document.getElementById('fullName').removeAttribute('required');
        }

        this.clearAuthMessages();
    }

    async handleAuth(e) {
        e.preventDefault();

        if (this.demoMode) {
            this.startDemoMode();
            return;
        }

        if (!supabase) {
            this.showAuthMessage('error', 'Supabase not configured properly');
            return;
        }

        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const fullName = document.getElementById('fullName').value.trim();

        // Basic validation
        if (!email || !password) {
            this.showAuthMessage('error', 'Please fill in all required fields');
            return;
        }

        if (password.length < 6) {
            this.showAuthMessage('error', 'Password must be at least 6 characters');
            return;
        }

        if (this.isSignUp && !fullName) {
            this.showAuthMessage('error', 'Please enter your full name');
            return;
        }

        this.clearAuthMessages();

        const submitBtn = document.getElementById('authSubmit');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = this.isSignUp ? 'Creating Account...' : 'Signing In...';
        submitBtn.disabled = true;

        try {
            if (this.isSignUp) {
                console.log('Attempting to sign up user:', email);
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: fullName
                        }
                    }
                });

                if (error) throw error;

                if (data?.user && !data.session) {
                    this.showAuthMessage('success', 'Account created! Please check your email for the verification link.');
                    console.log('Sign up successful, verification email sent');
                    return;
                } else if (data?.session) {
                    console.log('Sign up successful with immediate session');
                    this.showAuthMessage('success', 'Account created successfully!');
                }
            } else {
                console.log('Attempting to sign in user:', email);
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                console.log('Sign in successful');
            }

        } catch (error) {
            console.error('Auth error:', error);
            let errorMessage = error.message;

            // Provide user-friendly error messages
            if (errorMessage.includes('Invalid login credentials')) {
                errorMessage = 'Invalid email or password. Please check your credentials.';
            } else if (errorMessage.includes('Email not confirmed')) {
                errorMessage = 'Please verify your email address before signing in.';
            } else if (errorMessage.includes('User already registered')) {
                errorMessage = 'An account with this email already exists. Try signing in instead.';
            }

            this.showAuthMessage('error', errorMessage);
        } finally {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    }

    async signOut() {
        if (this.demoMode) {
            this.user = null;
            this.onUserSignedOut();
            return;
        }

        if (!supabase) return;

        try {
            const { error } = await supabase.auth.signOut();
            if (error) throw error;

            console.log('User signed out successfully');
        } catch (error) {
            console.error('Error signing out:', error);
            this.showAuthMessage('error', 'Failed to sign out. Please try again.');
        }
    }

    showAuthMessage(type, message) {
        const errorEl = document.getElementById('authError');
        const successEl = document.getElementById('authSuccess');

        if (type === 'error') {
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            successEl.style.display = 'none';
        } else {
            successEl.textContent = message;
            successEl.style.display = 'block';
            errorEl.style.display = 'none';
        }
    }

    clearAuthMessages() {
        const errorEl = document.getElementById('authError');
        const successEl = document.getElementById('authSuccess');
        errorEl.textContent = '';
        successEl.textContent = '';
        errorEl.style.display = 'none';
        successEl.style.display = 'none';
    }

    clearAuthForm() {
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
        document.getElementById('fullName').value = '';
        this.clearAuthMessages();
    }

    bindEvents() {
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.filterTopics(e.target.value);
            });
        }

        // Expand/Collapse all
        const expandAllBtn = document.getElementById('expandAllBtn');
        if (expandAllBtn) {
            expandAllBtn.addEventListener('click', () => {
                this.toggleAllTopics();
            });
        }

        // Export progress
        const exportBtn = document.getElementById('exportBtn');
        if (exportBtn) {
            exportBtn.addEventListener('click', () => {
                this.exportProgress();
            });
        }

        // Click outside modal to close
        const authModal = document.getElementById('authModal');
        authModal.addEventListener('click', (e) => {
            if (e.target === authModal) {
                this.hideAuthModal();
            }
        });
    }

    renderTopics() {
        if (!this.user) return;

        console.log('Rendering topics...');
        const container = document.getElementById('topicsContainer');
        if (!container) {
            console.error('Topics container not found');
            return;
        }

        container.innerHTML = '';

        this.data.topics.forEach((topic, index) => {
            const completedCount = topic.subtopics.filter(st => st.completed).length;
            const totalCount = topic.subtopics.length;
            const percentage = Math.round((completedCount / totalCount) * 100);

            const topicElement = document.createElement('div');
            topicElement.className = 'topic-section';
            topicElement.setAttribute('data-topic-id', topic.id);

            topicElement.innerHTML = `
                <div class="card">
                    <div class="card__header topic-header" data-topic="${topic.id}">
                        <div class="topic-header__left">
                            <button class="btn-icon topic-toggle" aria-expanded="false">
                                <svg class="icon icon--sm chevron-icon" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <div class="topic-info">
                                <h3 class="topic-title">${topic.name}</h3>
                                <p class="topic-description">${topic.description}</p>
                            </div>
                        </div>
                        <div class="topic-header__right">
                            <div class="progress-indicator">
                                <div class="progress-circle" data-percentage="${percentage}">
                                    <svg class="progress-ring" width="40" height="40">
                                        <circle class="progress-ring__circle" stroke="currentColor" stroke-width="3" 
                                                fill="transparent" r="18" cx="20" cy="20"/>
                                    </svg>
                                    <span class="progress-text">${percentage}%</span>
                                </div>
                                <span class="progress-stats-small">${completedCount}/${totalCount}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card__body topic-content" style="display: none;">
                        <div class="subtopics-list">
                            ${topic.subtopics.map(subtopic => `
                                <div class="subtopic-item ${subtopic.completed ? 'completed' : ''}" data-subtopic-id="${subtopic.id}">
                                    <div class="subtopic-header">
                                        <label class="checkbox-label">
                                            <input type="checkbox" ${subtopic.completed ? 'checked' : ''} 
                                                   data-topic="${topic.id}" data-subtopic="${subtopic.id}">
                                            <span class="checkbox-custom"></span>
                                            <span class="subtopic-name">${subtopic.name}</span>
                                        </label>
                                    </div>
                                    <div class="subtopic-comments">
                                        <textarea class="form-control" placeholder="Add your notes and comments here..." 
                                                  data-topic="${topic.id}" data-subtopic="${subtopic.id}">${subtopic.comments || ''}</textarea>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            container.appendChild(topicElement);
        });

        console.log(`Rendered ${this.data.topics.length} topics`);
        this.bindTopicEvents();
    }

    bindTopicEvents() {
        if (!this.user) return;

        // Topic toggle functionality
        document.querySelectorAll('.topic-header').forEach(header => {
            header.addEventListener('click', (e) => {
                if (e.target.closest('.progress-indicator')) return;

                const topicId = header.getAttribute('data-topic');
                this.toggleTopic(topicId);
            });
        });

        // Checkbox change events
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', async (e) => {
                const topicId = e.target.getAttribute('data-topic');
                const subtopicId = e.target.getAttribute('data-subtopic');
                await this.toggleSubtopic(topicId, subtopicId, e.target.checked);
            });
        });

        // Comment textarea events
        document.querySelectorAll('.subtopic-comments textarea').forEach(textarea => {
            textarea.addEventListener('blur', async (e) => {
                const topicId = e.target.getAttribute('data-topic');
                const subtopicId = e.target.getAttribute('data-subtopic');
                await this.updateSubtopicComment(topicId, subtopicId, e.target.value);
            });
        });
    }

    toggleTopic(topicId) {
        const topicElement = document.querySelector(`[data-topic-id="${topicId}"]`);
        const content = topicElement.querySelector('.topic-content');
        const toggle = topicElement.querySelector('.topic-toggle');
        const isExpanded = content.style.display !== 'none';

        if (isExpanded) {
            content.style.display = 'none';
            toggle.setAttribute('aria-expanded', 'false');
            topicElement.classList.remove('expanded');
        } else {
            content.style.display = 'block';
            toggle.setAttribute('aria-expanded', 'true');
            topicElement.classList.add('expanded');
        }
    }

    toggleAllTopics() {
        const expandAllBtn = document.getElementById('expandAllBtn');
        const expandAllText = document.getElementById('expandAllText');

        this.allExpanded = !this.allExpanded;

        document.querySelectorAll('.topic-section').forEach(topicElement => {
            const content = topicElement.querySelector('.topic-content');
            const toggle = topicElement.querySelector('.topic-toggle');

            if (this.allExpanded) {
                content.style.display = 'block';
                toggle.setAttribute('aria-expanded', 'true');
                topicElement.classList.add('expanded');
            } else {
                content.style.display = 'none';
                toggle.setAttribute('aria-expanded', 'false');
                topicElement.classList.remove('expanded');
            }
        });

        expandAllText.textContent = this.allExpanded ? 'Collapse All' : 'Expand All';
    }

    async toggleSubtopic(topicId, subtopicId, completed) {
        const topic = this.data.topics.find(t => t.id === topicId);
        const subtopic = topic.subtopics.find(st => st.id === subtopicId);

        subtopic.completed = completed;

        // Update UI
        const subtopicElement = document.querySelector(`[data-subtopic-id="${subtopicId}"]`);
        if (completed) {
            subtopicElement.classList.add('completed');
        } else {
            subtopicElement.classList.remove('completed');
        }

        this.updateProgress();
        await this.saveProgressToDatabase();
    }

    async updateSubtopicComment(topicId, subtopicId, comment) {
        const topic = this.data.topics.find(t => t.id === topicId);
        const subtopic = topic.subtopics.find(st => st.id === subtopicId);

        subtopic.comments = comment;
        await this.saveProgressToDatabase();
    }

    updateProgress() {
        if (!this.user) return;

        const totalSubtopics = this.data.topics.reduce((sum, topic) => sum + topic.subtopics.length, 0);
        const completedSubtopics = this.data.topics.reduce((sum, topic) => 
            sum + topic.subtopics.filter(st => st.completed).length, 0);

        const overallPercentage = Math.round((completedSubtopics / totalSubtopics) * 100);

        // Update overall progress
        const progressFill = document.getElementById('overallProgressFill');
        const progressText = document.getElementById('overallProgressText');
        const completedStats = document.getElementById('completedStats');
        const lastUpdated = document.getElementById('lastUpdated');

        if (progressFill) progressFill.style.width = `${overallPercentage}%`;
        if (progressText) progressText.textContent = `${overallPercentage}%`;
        if (completedStats) completedStats.textContent = `${completedSubtopics} of ${totalSubtopics} topics completed`;
        if (lastUpdated) lastUpdated.textContent = `Last updated: ${new Date().toLocaleString()}`;

        // Update individual topic progress circles
        this.data.topics.forEach(topic => {
            const completedCount = topic.subtopics.filter(st => st.completed).length;
            const totalCount = topic.subtopics.length;
            const percentage = Math.round((completedCount / totalCount) * 100);

            const progressCircle = document.querySelector(`[data-topic-id="${topic.id}"] .progress-circle`);
            if (progressCircle) {
                const circle = progressCircle.querySelector('.progress-ring__circle');
                const text = progressCircle.querySelector('.progress-text');
                const stats = progressCircle.parentElement.querySelector('.progress-stats-small');

                progressCircle.setAttribute('data-percentage', percentage);

                const radius = circle.r.baseVal.value;
                const circumference = radius * 2 * Math.PI;
                const offset = circumference - (percentage / 100) * circumference;

                circle.style.strokeDasharray = circumference;
                circle.style.strokeDashoffset = offset;

                if (text) text.textContent = `${percentage}%`;
                if (stats) stats.textContent = `${completedCount}/${totalCount}`;
            }
        });
    }

    filterTopics(searchTerm) {
        const normalizedSearch = searchTerm.toLowerCase().trim();

        document.querySelectorAll('.topic-section').forEach(topicElement => {
            const topicName = topicElement.querySelector('.topic-title').textContent.toLowerCase();
            const subtopics = Array.from(topicElement.querySelectorAll('.subtopic-name')).map(el => el.textContent.toLowerCase());

            const topicMatches = topicName.includes(normalizedSearch);
            const subtopicMatches = subtopics.some(subtopic => subtopic.includes(normalizedSearch));

            if (normalizedSearch === '' || topicMatches || subtopicMatches) {
                topicElement.style.display = 'block';

                // If searching and subtopic matches, expand the topic
                if (normalizedSearch !== '' && subtopicMatches) {
                    const content = topicElement.querySelector('.topic-content');
                    const toggle = topicElement.querySelector('.topic-toggle');
                    content.style.display = 'block';
                    toggle.setAttribute('aria-expanded', 'true');
                    topicElement.classList.add('expanded');
                }
            } else {
                topicElement.style.display = 'none';
            }
        });
    }

    exportProgress() {
        if (!this.user) return;

        const totalSubtopics = this.data.topics.reduce((sum, topic) => sum + topic.subtopics.length, 0);
        const completedSubtopics = this.data.topics.reduce((sum, topic) => 
            sum + topic.subtopics.filter(st => st.completed).length, 0);

        let exportText = `DevOps Preparation Progress Report - ${this.user.email}\n`;
        exportText += `Generated: ${new Date().toLocaleString()}\n`;
        exportText += `Overall Progress: ${completedSubtopics}/${totalSubtopics} (${Math.round((completedSubtopics / totalSubtopics) * 100)}%)\n\n`;

        this.data.topics.forEach(topic => {
            const completed = topic.subtopics.filter(st => st.completed).length;
            const total = topic.subtopics.length;
            const percentage = Math.round((completed / total) * 100);

            exportText += `${topic.name}: ${completed}/${total} (${percentage}%)\n`;

            topic.subtopics.forEach(subtopic => {
                const status = subtopic.completed ? '‚úì' : '‚óã';
                exportText += `  ${status} ${subtopic.name}`;
                if (subtopic.comments) {
                    exportText += ` - ${subtopic.comments}`;
                }
                exportText += '\n';
            });
            exportText += '\n';
        });

        // Create and download file
        const blob = new Blob([exportText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `devops-prep-progress-${this.user.email.split('@')[0]}-${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
}

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing DevOps Tracker...');

    try {
        window.tracker = new DevOpsTracker();
    } catch (error) {
        console.error('Failed to initialize DevOps Tracker:', error);
        const container = document.getElementById('topicsContainer') || document.body;
        container.innerHTML = `
            <div style="background: #fee; border: 1px solid #fcc; padding: 1rem; border-radius: 8px; margin: 1rem;">
                <h3>‚ùå Initialization Failed</h3>
                <p>Failed to load DevOps Tracker. Please check the browser console for details.</p>
                <p><strong>Error:</strong> ${error.message}</p>
            </div>
        `;
    }
});
    </script>
</body>
</html>
